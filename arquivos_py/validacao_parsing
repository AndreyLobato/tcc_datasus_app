--select substring(path, 20), * from arquivos limit 10
--select INSTR("a,b,c", ",")

/*
--essa querie foi utilizada para pesquisar os diretorios publicos disponiveis no datasus 
select distinct substring(path, 1, instr(path, "/")) as diretorios
from (
	select distinct substring(path, 20) as path from arquivos
	)
*/

with filtro as (
select distinct substring(path, 1, instr(path, "/")) as diretorios, id
from (
	select distinct substring(path, 20) as path, id from arquivos
	)where substring(path, 1, instr(path, "/")) = "SIASUS/"
),

parse as (
select nome,
path,
substring(nome, instr(nome, ".")) as extensao,
	   substring(nome,instr(nome, ".") - 2, 2) as mes, 
	   substring(nome,instr(nome, ".") - 4, 2) as ano,
	   substring(nome,instr(nome, ".") - 6, 2) as UF, 
	   substring(nome,1, instr(nome, ".") -7) as subsetor   

	   from arquivos ar 
inner join filtro f on ar.id= f.id 
)

select distinct *from parse 
where subsetor in ("PAM")
--and extensao != ".EXE"
order by subsetor asc